# 🔑 نظام نسيت كلمة المرور - تطبيق جمانة

## ✨ الميزة الجديدة:

تم إضافة نظام كامل لاستعادة كلمة المرور عبر البريد الإلكتروني!

---

## 🎯 المميزات:

### 1️⃣ **صفحة "نسيت كلمة المرور"** 🔑
- الطالب يدخل بريده الإلكتروني
- التحقق من وجود البريد في النظام
- إنشاء رمز (token) آمن
- إرسال رابط إعادة التعيين عبر البريد

### 2️⃣ **إرسال البريد الإلكتروني** 📧
- استخدام EmailJS (مجاني)
- رابط فريد لكل طلب
- صلاحية محدودة (ساعة واحدة)
- رسالة احترافية

### 3️⃣ **صفحة إعادة تعيين كلمة المرور** 🔐
- التحقق من صلاحية الرمز
- التحقق من انتهاء الصلاحية
- تحديث كلمة المرور
- رسائل واضحة للنجاح/الفشل

### 4️⃣ **الأمان** 🛡️
- رموز فريدة لكل طلب
- صلاحية محدودة بالوقت
- حذف الرمز بعد الاستخدام
- التحقق من جميع المدخلات

---

## 📂 الملفات الجديدة:

### 1. `src/pages/ForgotPassword.jsx` ⭐ جديد
**الوظيفة:** طلب رابط إعادة تعيين كلمة المرور

**المحتوى:**
- نموذج إدخال البريد الإلكتروني
- التحقق من وجود البريد
- إنشاء رمز فريد
- إرسال البريد (EmailJS)
- رسالة نجاح

### 2. `src/pages/ResetPassword.jsx` ⭐ جديد
**الوظيفة:** إعادة تعيين كلمة المرور الجديدة

**المحتوى:**
- قراءة الرمز من URL
- التحقق من صلاحية الرمز
- نموذج كلمة المرور الجديدة
- تحديث كلمة المرور
- رسالة نجاح

---

## 🔄 تدفق العمل الكامل:

### الخطوة 1️⃣: الطالب نسي كلمة المرور
```
صفحة تسجيل الدخول
         ↓
ضغط "🔑 نسيت كلمة المرور؟"
         ↓
صفحة /forgot-password
```

### الخطوة 2️⃣: طلب إعادة التعيين
```
إدخال البريد الإلكتروني
         ↓
التحقق من وجود البريد
         ↓
إنشاء رمز فريد (token)
         ↓
حفظ الرمز في localStorage
{
  token: {
    email: "student@test.com",
    expiry: timestamp (بعد ساعة)
  }
}
         ↓
إنشاء رابط إعادة التعيين
https://yoursite.com/reset-password?token=xyz123
         ↓
إرسال البريد عبر EmailJS
         ↓
رسالة نجاح ✅
```

### الخطوة 3️⃣: فتح البريد
```
الطالب يفتح بريده الإلكتروني
         ↓
يجد رسالة من "تطبيق جمانة"
         ↓
يضغط على الرابط
         ↓
ينتقل لـ /reset-password?token=xyz123
```

### الخطوة 4️⃣: إعادة التعيين
```
صفحة إعادة التعيين
         ↓
التحقق من صلاحية الرمز
         ↓
صالح ✅ → نموذج كلمة المرور
منتهي ❌ → رسالة خطأ
         ↓
إدخال كلمة المرور الجديدة
         ↓
التحقق من التطابق
         ↓
تحديث كلمة المرور في localStorage
         ↓
حذف الرمز المستخدم
         ↓
رسالة نجاح 🎉
         ↓
تحويل تلقائي لصفحة تسجيل الدخول
```

---

## 📧 إعداد EmailJS:

### خطوات الإعداد (مجاني):

#### 1️⃣ إنشاء حساب على EmailJS:
```
1. اذهب إلى: https://www.emailjs.com
2. اضغط "Sign Up" (مجاني)
3. سجل دخول بالبريد الإلكتروني
```

#### 2️⃣ إنشاء خدمة بريد إلكتروني:
```
1. من Dashboard → اضغط "Add New Service"
2. اختر Gmail (أو أي خدمة أخرى)
3. اربط حسابك
4. احفظ Service ID
```

#### 3️⃣ إنشاء قالب البريد:
```
1. اذهب إلى "Email Templates"
2. اضغط "Create New Template"
3. استخدم القالب التالي:
```

**قالب البريد:**
```html
مرحباً {{to_name}}،

تلقينا طلباً لإعادة تعيين كلمة المرور لحسابك في {{app_name}}.

لإعادة تعيين كلمة المرور، اضغط على الرابط التالي:

{{reset_link}}

هذا الرابط صالح لمدة ساعة واحدة فقط.

إذا لم تطلب إعادة تعيين كلمة المرور، تجاهل هذه الرسالة.

مع التحيات،
فريق تطبيق جمانة للرياضيات 🎓
```

#### 4️⃣ الحصول على المعلومات:
```
- Service ID: مثل service_abc123
- Template ID: مثل template_xyz456
- Public Key: من Account → API Keys
```

#### 5️⃣ تحديث الكود:
في ملف `src/pages/ForgotPassword.jsx`:
```javascript
const serviceID = 'service_jumana_math' // استبدل بـ Service ID الخاص بك
const templateID = 'template_reset_password' // استبدل بـ Template ID
const publicKey = 'YOUR_PUBLIC_KEY' // استبدل بـ Public Key
```

---

## 🔒 نظام الأمان:

### 1. **رموز فريدة (Tokens):**
```javascript
const resetToken = Math.random().toString(36).substring(2, 15) + 
                   Math.random().toString(36).substring(2, 15)

// مثال: "k9g3j2h8f5d1a4"
```

### 2. **صلاحية محدودة:**
```javascript
const expiryTime = Date.now() + 3600000 // ساعة واحدة (بالملي ثانية)
```

### 3. **التحقق من الصلاحية:**
```javascript
if (Date.now() > tokenData.expiry) {
  setError('انتهت صلاحية الرابط')
}
```

### 4. **استخدام لمرة واحدة:**
```javascript
// بعد تحديث كلمة المرور، حذف الرمز
delete resetTokens[token]
```

---

## 💾 تخزين الرموز:

### في localStorage:

```javascript
localStorage.setItem('resetTokens', JSON.stringify({
  'k9g3j2h8f5d1a4': {
    email: 'student@test.com',
    expiry: 1705234567890
  },
  'p2f6m8n1q4r7t9': {
    email: 'another@test.com',
    expiry: 1705238901234
  }
}))
```

---

## 🎨 واجهة المستخدم:

### صفحة "نسيت كلمة المرور":
```
┌─────────────────────────┐
│         🔑              │
│  نسيت كلمة المرور؟      │
│                         │
│  📝 الخطوات:           │
│  1. أدخل بريدك          │
│  2. سنرسل لك رابط       │
│  3. افتح البريد          │
│  4. أدخل كلمة مرور جديدة │
│                         │
│  📧 البريد:             │
│  [________________]     │
│                         │
│  [📧 إرسال رابط]       │
│                         │
│  ← العودة لتسجيل الدخول │
└─────────────────────────┘
```

### صفحة "إعادة التعيين":
```
┌─────────────────────────┐
│         🔐              │
│  إعادة تعيين كلمة المرور│
│                         │
│  الحساب:                │
│  student@test.com       │
│                         │
│  🔒 كلمة المرور الجديدة:│
│  [________________]     │
│                         │
│  🔒 تأكيد كلمة المرور:  │
│  [________________]     │
│                         │
│  [✅ تحديث]            │
└─────────────────────────┘
```

---

## 📧 محتوى البريد المرسل:

```
الموضوع: إعادة تعيين كلمة المرور - تطبيق جمانة للرياضيات

مرحباً أحمد،

تلقينا طلباً لإعادة تعيين كلمة المرور لحسابك.

لإعادة تعيين كلمة المرور، اضغط على الرابط:
https://jumana-math.netlify.app/reset-password?token=k9g3j2h8f5d1a4

هذا الرابط صالح لمدة ساعة واحدة فقط.

إذا لم تطلب إعادة التعيين، تجاهل هذه الرسالة.

مع التحيات،
فريق تطبيق جمانة 🎓
```

---

## 🔧 التفاصيل التقنية:

### الملفات المضافة:
1. `src/pages/ForgotPassword.jsx`
2. `src/pages/ResetPassword.jsx`

### الملفات المحدّثة:
1. `src/pages/Login.jsx` - إضافة رابط
2. `src/App.jsx` - إضافة المسارات
3. `package.json` - إضافة @emailjs/browser

### التبعيات الجديدة:
```json
"@emailjs/browser": "^3.11.0"
```

---

## 🚀 كيفية الاستخدام:

### للطالب:

#### نسيت كلمة المرور؟
```
1. افتح صفحة تسجيل الدخول
2. اضغط "🔑 نسيت كلمة المرور؟"
3. أدخل بريدك الإلكتروني
4. اضغط "إرسال رابط إعادة التعيين"
5. افتح بريدك الإلكتروني
6. اضغط على الرابط في الرسالة
7. أدخل كلمة المرور الجديدة
8. اضغط "تحديث"
9. ✅ تم! سجّل دخول بكلمة المرور الجديدة
```

---

## ⚙️ إعداد EmailJS (للإنتاج):

### الخطوة 1: إنشاء حساب
```
1. https://www.emailjs.com → Sign Up
2. تأكيد البريد الإلكتروني
3. تسجيل الدخول
```

### الخطوة 2: إنشاء خدمة البريد
```
1. Email Services → Add New Service
2. اختر Gmail (أو Outlook/Yahoo...)
3. ربط حسابك
4. احفظ Service ID
```

### الخطوة 3: إنشاء قالب
```
1. Email Templates → Create New Template
2. الاسم: "Reset Password - Jumana Math"
3. Template ID: template_reset_password
4. المحتوى:

Subject: إعادة تعيين كلمة المرور - تطبيق جمانة

Body:
مرحباً {{to_name}}،

لإعادة تعيين كلمة المرور، اضغط:
{{reset_link}}

صالح لمدة ساعة واحدة.

فريق جمانة 🎓
```

### الخطوة 4: الحصول على Public Key
```
1. Account → API Keys
2. انسخ Public Key
```

### الخطوة 5: تحديث الكود
في `src/pages/ForgotPassword.jsx`:
```javascript
const serviceID = 'service_abc123'     // من الخطوة 2
const templateID = 'template_xyz456'   // من الخطوة 3
const publicKey = 'YOUR_PUBLIC_KEY'    // من الخطوة 4
```

### الخطوة 6: تفعيل الإرسال
في `src/pages/ForgotPassword.jsx`، غيّر:
```javascript
// من هذا (للتطوير):
console.log('رابط إعادة تعيين كلمة المرور:', resetLink)

// إلى هذا (للإنتاج):
await emailjs.send(serviceID, templateID, templateParams, publicKey)
```

---

## 🧪 الاختبار في بيئة التطوير:

### حالياً (بدون EmailJS):
```
1. اذهب لـ /forgot-password
2. أدخل بريد مسجل
3. اضغط "إرسال"
4. افتح Console (F12)
5. ستجد الرابط مطبوعاً
6. انسخ الرابط والصقه في المتصفح
7. أعد تعيين كلمة المرور
```

### بعد إعداد EmailJS:
```
1. اذهب لـ /forgot-password
2. أدخل بريدك الحقيقي
3. اضغط "إرسال"
4. افتح بريدك
5. اضغط على الرابط
6. أعد تعيين كلمة المرور
```

---

## 🔐 الأمان والخصوصية:

### الميزات الأمنية:
✅ **رموز عشوائية** - لا يمكن تخمينها  
✅ **صلاحية محدودة** - ساعة واحدة فقط  
✅ **استخدام مرة واحدة** - يُحذف بعد الاستخدام  
✅ **التحقق من البريد** - يجب أن يكون مسجل  
✅ **حد أدنى لكلمة المرور** - 6 أحرف  

### القيود الحالية:
⚠️ **localStorage** - البيانات محلية  
⚠️ **بدون تشفير** - مناسب للبيئة التعليمية  
⚠️ **رسائل يدوية** - في بيئة التطوير  

---

## 💡 حالات الاستخدام:

### الحالة 1: رابط صالح
```
الطالب يضغط على الرابط في البريد
         ↓
صفحة إعادة التعيين تفتح
         ↓
البريد الإلكتروني يظهر
         ↓
يدخل كلمة مرور جديدة
         ↓
✅ نجح! تم التحديث
```

### الحالة 2: رابط منتهي
```
الطالب يضغط على رابط قديم (بعد ساعة)
         ↓
❌ رسالة: "انتهت صلاحية الرابط"
         ↓
زر "طلب رابط جديد"
```

### الحالة 3: بريد غير مسجل
```
الطالب يدخل بريد غير موجود
         ↓
❌ "البريد الإلكتروني غير مسجل"
         ↓
يمكن التسجيل أولاً
```

---

## 📊 مثال كامل:

### السيناريو:
```
الطالب: أحمد محمد
البريد: ahmed@test.com
نسي كلمة المرور: 123456
```

### الخطوات:
```
1. أحمد يذهب لـ /login
2. يضغط "نسيت كلمة المرور؟"
3. يدخل: ahmed@test.com
4. يضغط "إرسال"
5. النظام ينشئ: token = "k9g3j2h8f5d1a4"
6. النظام يحفظ:
   {
     "k9g3j2h8f5d1a4": {
       "email": "ahmed@test.com",
       "expiry": 1705234567890
     }
   }
7. يُنشأ الرابط:
   https://jumana-math.netlify.app/reset-password?token=k9g3j2h8f5d1a4
8. يُرسل عبر EmailJS إلى: ahmed@test.com
9. أحمد يفتح بريده
10. يضغط على الرابط
11. يدخل كلمة مرور جديدة: "newpass123"
12. النظام يحدث كلمة المرور
13. النظام يحذف الرمز
14. ✅ نجح! أحمد يسجل دخول بكلمة المرور الجديدة
```

---

## 🎨 التصميم:

### صفحة نسيت كلمة المرور:
- 🔑 أيقونة المفتاح
- عنوان واضح
- تعليمات خطوة بخطوة
- نموذج بسيط
- رسائل خطأ واضحة
- رابط للعودة

### صفحة إعادة التعيين:
- 🔐 أيقونة القفل
- عرض البريد الإلكتروني
- حقلين لكلمة المرور
- التحقق من التطابق
- رسالة نجاح جميلة

---

## 📝 ملاحظات مهمة:

### للتطوير (حالياً):
```
✅ الرابط يُطبع في Console
✅ يمكن نسخه واستخدامه
✅ لا حاجة لإعداد EmailJS للاختبار
```

### للإنتاج (Netlify):
```
⚙️ يجب إعداد EmailJS
⚙️ تحديث المعلومات في الكود
⚙️ اختبار إرسال البريد
⚙️ التأكد من وصول الرسائل
```

---

## 🆙 الترقية لقاعدة بيانات:

### مع Firebase:
```javascript
// إرسال بريد إعادة التعيين
await firebase.auth().sendPasswordResetEmail(email)
```

### مع Supabase:
```javascript
// إرسال بريد إعادة التعيين
await supabase.auth.resetPasswordForEmail(email)
```

### الفوائد:
- ✅ إرسال تلقائي
- ✅ أمان أعلى
- ✅ تشفير البيانات
- ✅ لا حاجة لـ EmailJS

---

## 🎯 الفوائد:

### للطالب:
✅ **راحة البال** - يمكن استعادة الحساب  
✅ **سهل الاستخدام** - خطوات واضحة  
✅ **آمن** - رموز محدودة الصلاحية  

### للمعلم:
✅ **أقل دعم فني** - الطلاب يحلون المشكلة بأنفسهم  
✅ **نظام احترافي** - مثل المواقع الكبيرة  

---

## 🔄 تحديثات App.jsx:

### المسارات الجديدة:
```javascript
<Route path="/forgot-password" element={<ForgotPassword />} />
<Route path="/reset-password" element={<ResetPassword />} />
```

### المسارات العامة (Public):
- `/login` - تسجيل دخول
- `/signup` - تسجيل جديد
- `/forgot-password` - نسيت كلمة المرور ⭐ جديد
- `/reset-password` - إعادة التعيين ⭐ جديد

---

## 📦 التثبيت:

### بعد تحديث package.json:
```bash
npm install
```

هذا سيثبت:
```
@emailjs/browser@^3.11.0
```

---

## 🎉 النتيجة النهائية:

**التطبيق الآن يحتوي على:**
- ✅ نظام استعادة كلمة المرور كامل
- ✅ إرسال بريد إلكتروني حقيقي (مع EmailJS)
- ✅ رموز آمنة محدودة الصلاحية
- ✅ صفحات احترافية
- ✅ رسائل واضحة
- ✅ سهل الاستخدام
- ✅ جاهز للإنتاج

---

## 📚 المراجع:

### EmailJS:
- الموقع: https://www.emailjs.com
- التوثيق: https://www.emailjs.com/docs
- أمثلة: https://www.emailjs.com/docs/examples

### البدائل:
- Firebase Auth (أوتوماتيكي)
- Supabase Auth (أوتوماتيكي)
- SendGrid (متقدم)
- Mailgun (متقدم)

---

<div align="center">

**🔑 نظام استعادة كلمة المرور الكامل!**

**إرسال بريد إلكتروني حقيقي مع EmailJS!**

**تطبيق جمانة للرياضيات** 🎓

</div>

